var TroopTemplates={current:null,loadTemplate:null,deleteLink:null,currentTemplates:0,maxTemplates:2,init:function(){if(document.location.hash)TroopTemplates.loadTemplate=document.location.hash.substring(1);if(TroopTemplates.currentTemplates>=TroopTemplates.maxTemplates){if(!TroopTemplates.loadTemplate)TroopTemplates.loadTemplate=true}else TroopTemplates.selectCreate();TroopTemplates.updateTemplateList();if(!mobile)$('#troop_template_list').css('height',$('#troop_template_units').height()+'px');$('#template_create').click(TroopTemplates.selectCreate);$('#troop_template_units').find('form').submit(TroopTemplates.validate)},resetSelect:function(select){select.find('option:first').attr('selected','selected').parent('select')},useTemplate:function(template_id){if(typeof template_id=='object')template_id=$(template_id).find('option:selected').val();if(template_id){var template=TroopTemplates.current[template_id];$.each(template,function(k,v){var $input=$('#unit_input_'+k);if($input.length)$input.val(v)});$('#template_id').val(template_id)};return false},validate:function(){if($('#template_name').val().length<1){UI.ErrorMessage('You must enter a valid template name.');return false};if($('#template_name').val().length>50){UI.ErrorMessage('The template name is too long. (max 50 characters)');return false};if($('#template_name').val().trim()==''){UI.ErrorMessage('The template name must contain at least one visible character');return false};return true},updateTemplateList:function(){var $list=$('#troop_template_list').find('ul'),x=1;$.each(TroopTemplates.current,function(i,template){template.sanitized_name=$('<a></a>').text(template.name).text();template.display_name='';for(var char_index=0;char_index<template.sanitized_name.length;char_index++)template.display_name+=template.sanitized_name.charAt(char_index)+'&shy;';var $li=$('<li><a href="#'+template.id+'"></a></li>'),$a=$li.find('a');$a.data('template-id',template.id);$a.data('li-id',x);$a.click(TroopTemplates.selectTemplate);$a.html(template.display_name);$list.append($li);var $delete=$('<img src="/graphic/delete_14.png" alt="" />').click(function(e){e.stopPropagation();document.location.replace(TroopTemplates.deleteLink+'&id='+template.id)});$a.prepend($delete);if(template.id==TroopTemplates.loadTemplate||TroopTemplates.loadTemplate===true){TroopTemplates.selectTemplate.call($a);TroopTemplates.loadTemplate=0};x++})},selectCreate:function(e){if(typeof e!='undefined')e.preventDefault();if(TroopTemplates.currentTemplates>=TroopTemplates.maxTemplates){UI.ErrorMessage('Maximum number of troop templates reached.');return false};var inputType=mobile?'number':'text';$('#troop_template_units').find('input[type='+inputType+']').val('');$('#template_id').val(0);$('#template_name').val('');$('#template_button').val('Create template');TroopTemplates.setSelected(0)},selectTemplate:function(){var $this=$(this),template_id=$this.data('template-id'),li_id=$this.data('li-id'),template=TroopTemplates.current[template_id];TroopTemplates.setSelected(li_id);$('#template_id').val(template.id);$('#template_name').val(template.name);$('#template_button').val('Edit template');$.each(template,function(k,v){var $input=$('#unit_input_'+k);if($input.length)$input.val(v)})},setSelected:function(index){var $li=$('#troop_template_list').find('li');$li.removeClass('selected');$li.eq(index).addClass('selected')}}